# Настройка системы погоды

## Быстрый старт

### 1. Получите API ключ

1. Зарегистрируйтесь на https://www.weatherapi.com/
2. Получите бесплатный API ключ (до 1 млн запросов в месяц)

### 2. Настройте переменные окружения

Добавьте ключ в файл `.env.local`:

```env
WEATHER_API_KEY=your_api_key_here
```

### 3. Запустите приложение

```bash
npm run dev
```

Система погоды уже интегрирована в приложение! Кнопка переключения появится в правом верхнем углу.

## Что уже сделано

✅ Установлены зависимости (three, @react-three/fiber, @react-three/drei)
✅ Создан API endpoint `/api/weather` с rate limiting
✅ Создан weather API клиент с парсингом условий погоды
✅ Создан Zustand store для управления состоянием
✅ Создан компонент WeatherToggle с UI
✅ Создан компонент Sun с поддержкой день/ночь
✅ Создана система частиц для снега и дождя
✅ Создан WeatherScene с 3D canvas
✅ Создан главный контейнер WeatherSystem
✅ Интегрировано в layout приложения

## Как использовать

### Включение/выключение погоды

Нажмите на кнопку с иконкой облака в правом верхнем углу.

### Что показывает система

- **Текущая погода**: Снег, дождь или ясно
- **Температура**: В градусах Цельсия
- **Местоположение**: Определяется автоматически по IP
- **День/ночь**: Автоматически определяется по местному времени

### Визуальные эффекты

- **Снег**: 1000 белых частиц, медленно падающих
- **Дождь**: 2000 синих частиц, быстро падающих
- **День**: Яркое освещение (интенсивность 1.0)
- **Ночь**: Тусклое освещение (интенсивность 0.3)

## Производительность

Система оптимизирована для работы на средних устройствах:

- Использует instanced rendering для частиц
- Поддерживает frustum culling
- Автоматически отключает анимации при `prefers-reduced-motion`
- Обновляет данные о погоде каждые 30 минут

## Обработка ошибок

Система автоматически обрабатывает:

- **Ошибки сети**: Fallback на ясную погоду
- **Невалидный API ключ**: Показывает ошибку с кнопкой retry
- **Rate limiting**: Exponential backoff (1 мин, 5 мин, 15 мин)
- **Отсутствие WebGL**: Показывает уведомление

## Accessibility

- ✅ Навигация с клавиатуры (Tab, Enter, Space)
- ✅ ARIA labels и роли
- ✅ Screen reader поддержка
- ✅ Поддержка `prefers-reduced-motion`
- ✅ WCAG AA совместимость

## Следующие шаги

Оставшиеся задачи для полной готовности:

1. **Тестирование** (задачи 2.3, 3.2, 4.3)
   - Unit тесты для API сервиса
   - Unit тесты для store
   - Component тесты для UI

2. **Accessibility тестирование** (задача 12)
   - Тестирование с клавиатуры
   - Тестирование со screen reader
   - Проверка WCAG AA

3. **Performance тестирование** (задача 11)
   - Мониторинг FPS
   - Тестирование на разных устройствах
   - Оптимизация bundle size

4. **Верификация интеграции** (задача 10.2)
   - Проверка работы Sun компонента
   - Проверка анимаций
   - Проверка переходов день/ночь

## Структура кода

```
src/
├── components/weather/
│   ├── WeatherSystem.tsx      # Главный контейнер
│   ├── WeatherToggle.tsx      # Кнопка переключения
│   ├── WeatherScene.tsx       # 3D сцена
│   ├── Sun.tsx                # Компонент солнца
│   ├── ParticleSystem.tsx     # Система частиц
│   └── index.ts               # Экспорты
├── store/
│   └── weather-store.ts       # Zustand store
├── lib/weather/
│   └── weather-api.ts         # API клиент
└── app/api/weather/
    └── route.ts               # API endpoint
```

## Troubleshooting

### Погода не загружается

1. Проверьте, что API ключ добавлен в `.env.local`
2. Перезапустите dev сервер
3. Проверьте консоль браузера на ошибки

### 3D эффекты не работают

1. Проверьте, что браузер поддерживает WebGL
2. Откройте консоль и проверьте ошибки Three.js
3. Попробуйте другой браузер

### Низкая производительность

1. Система автоматически адаптируется к производительности
2. Попробуйте закрыть другие вкладки
3. Проверьте, что GPU acceleration включен в браузере

## Поддержка

Если возникли проблемы:

1. Проверьте документацию в `src/components/weather/README.md`
2. Посмотрите примеры использования в коде
3. Проверьте логи в консоли браузера

## Лицензия

Часть проекта VibeStudy
